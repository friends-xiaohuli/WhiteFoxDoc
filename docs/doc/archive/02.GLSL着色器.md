---
title: "OpenGL shaders"
---
# OpenGL shaders（by photon）

哈喽大家好！

这里是霜澪，此节将贴出在制作 `photon` 使用的`OpenGL shaders` 有关内容。

![00](/img/03.gif)

::: tip
此部分演示的内容为1.20.1 `photon` 的着色器作为参考。
:::

## JSON 配置部分

此部分用标准示例解析。

`vertex: "ldlib:particle"`

> 顶点着色器用的是库里的一个通用粒子着色器。(mei找到其他的值)

`fragment: "ldlib:fancy_line"`

> 片段着色器就是 新建着色器的代码。

`attributes:"Position", "UV0", "Color", "UV2"`

> 输入的顶点属性，包括位置、纹理坐标、颜色。

`samplers` 纹理采样器

`uniforms` 外部传入 shader 的全局变量

## 混合

混合是一种技术，它允许你将新绘制的像素（源）的颜色与帧缓冲区中已有的像素（目标）的颜色进行组合，而不是简单的覆盖。这主要用于实现透明和半透明效果。

混合方程（Blending Equation）：`最终颜色 = (源颜色 * 源因子) + (目标颜色 * 目标因子)`

``` json
"blend": {
        "func": "add",
        "srcrgb": "srcalpha",
        "dstrgb": "1-srcalpha"
    },
```

blend混合

- func 混合方法
- src 源rgb
- dst 目标rgb
  
srcalpha 源Alpha值
1 - srcAlpha 最经典的用法是作为目标因子

此部分使用标准的 alpha 混合（源颜色 * α + 目标颜色 * (1-α)）

### 混合运算

可使用以下混合运算：

``` text
Add 	将源和目标相加。
Sub 	从源减去目标。
RevSub 	从目标减去源。
Min 	使用源和目标中的较小者。
Max 	使用源和目标中的较大者。
```

### 混合系数

以下所有属性对 Blend 命令中的 SrcFactor 和 DstFactor 都有效。源是指计算所得颜色，目标是指屏幕上已有的颜色。
如果 BlendOp 在使用逻辑运算，则将忽略混合系数。

``` text
One 	值为 1 - 让源或目标颜色通过。
Zero 	值为 0 - 删除源或目标值。
SrcColor 	此阶段的值乘以源颜色值。
SrcAlpha 	此阶段的值乘以源 Alpha 值。
DstColor 	此阶段的值乘以帧缓冲区源颜色值。
DstAlpha 	此阶段的值乘以帧缓冲区源 Alpha 值。
OneMinusSrcColor 	此阶段的值乘以（1 - 源颜色）。
OneMinusSrcAlpha 	此阶段的值乘以（1 - 源 Alpha）。
OneMinusDstColor 	此阶段的值乘以（1 - 目标颜色）。
OneMinusDstAlpha 	此阶段的值乘以（1 - 目标 Alpha）。
```

## 常见的混合方式

``` text
Blend SrcAlpha OneMinusSrcAlpha // 传统透明度
Blend One OneMinusSrcAlpha // 预乘透明度
Blend One One // 加法
Blend OneMinusDstColor One // 软加法
Blend DstColor Zero // 乘法
Blend DstColor SrcColor // 2x 乘法
```

## OpengGL

OpengGL提供了15中混合函数供开发者快速使用，包括（混合系数枚举值、混合因子、注释）：

``` text
GL_ZERO (0,0,0,0) 混合因子都为0；
GL_ONE (1,1,1,1) 混合因子都为1；
GL_SRC_COLOR (Rs,Gs,Bs,As) 混合因子为源颜色分量；
GL_ONE_MINUS_SRC_COLOR (1-Rs,1-Gs,1-Bs,1-As) 混合因子为1-C_source;
GL_SRC_ALPHA (As,As,As,As) 混合因子为源Alpha值；
GL_ONE_MINUS_SRC_ALPHA (1-As,1-As,1-As,1-As) 混合因子为1-f_source;
GL_DST_COLOR (Rd,Gd,Bd,Ad) 混合因子为目标颜色分量；
GL_ONE_MINUS_DST_COLOR (1-Rd,1-Gd,1-Bd,1-Ad) 混合因子为1-C_destination;
GL_DST_ALPHA (Ad,Ad,Ad,Ad) 混合因子为目标Alpha值；
GL_ONE_MINUS_DST_ALPHA (1-Ad,1-Ad,1-Ad,1-Ad) 混合因子为1-f_destination;
GL_CONSTANT_COLOR (Rc,Gc,Bc,Ac) 混合因子为常量颜色；
GL_ONE_MINUS_CONSTANT_COLOR (1-Rc,1-Gc,1-Bc,1-Ac) 混合因子为1-常量颜色；
GL_CONSTANT_ALPHA (Rc,Gc,Bc,Ac) 混合因子为常量Alpha;
GL_ONE_MINUS_CONSTANT_ALPHA (1-Rc,1-Gc,1-Bc,1-Ac) 混合因子为1-常量Alpha;
GL_SRC_ALPHA_SATURATE (min(As,1-Ad)) 混合因子为源Alpha和（1-目标Alpha）的最小值；

```

其中R指的是红色通道、G指的是绿色通道、B指的是蓝色通道、A指的是Alpha、
s指的是源（输入片段），d指的是目标（目标像素），c指的是自定义的常量。

以GL_ONE_MINUS_DST_ALPHA为例，1-Ad指的是1-目标Alpha。

## 参考文献

[GLSL 中文手册](https://github.com/wshxbqq/GLSL-Card)

[OpenGL 混合使用、算法和计算](https://www.jianshu.com/p/775d981165a0)

[Minecraft Shaders Information](https://github.com/McTsts/Minecraft-Shaders-Wiki/tree/main)

[Minecraft GLSL Shader着色器基础教程#3 后处理着色器的应用](https://www.bilibili.com/opus/937366369121337353)

[The Book of Shaders](https://thebookofshaders.com/)

[OpenGL入门1.3：着色器 GLSL](https://www.cnblogs.com/zhxmdefj/p/11241537.html)
